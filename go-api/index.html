<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Aditya Rizky Ramadhan">

<title>Pemrograman Golang Web dan API</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#clean-architecture" id="toc-clean-architecture" class="nav-link active" data-scroll-target="#clean-architecture"><span class="header-section-number">1</span> Clean Architecture</a>
  <ul class="collapse">
  <li><a href="#pengertian-clean-architecture" id="toc-pengertian-clean-architecture" class="nav-link" data-scroll-target="#pengertian-clean-architecture"><span class="header-section-number">1.1</span> Pengertian Clean Architecture</a></li>
  <li><a href="#penerapan-clean-architecture" id="toc-penerapan-clean-architecture" class="nav-link" data-scroll-target="#penerapan-clean-architecture"><span class="header-section-number">1.2</span> Penerapan Clean Architecture</a></li>
  </ul></li>
  <li><a href="#rest-api" id="toc-rest-api" class="nav-link" data-scroll-target="#rest-api"><span class="header-section-number">2</span> REST API</a>
  <ul class="collapse">
  <li><a href="#pengertian-api" id="toc-pengertian-api" class="nav-link" data-scroll-target="#pengertian-api"><span class="header-section-number">2.1</span> Pengertian API</a></li>
  <li><a href="#pengertian-rest" id="toc-pengertian-rest" class="nav-link" data-scroll-target="#pengertian-rest"><span class="header-section-number">2.2</span> Pengertian REST</a></li>
  <li><a href="#why-use-restful-api" id="toc-why-use-restful-api" class="nav-link" data-scroll-target="#why-use-restful-api"><span class="header-section-number">2.3</span> Why use RESTful API?</a></li>
  </ul></li>
  <li><a href="#pengenalan-gin-gonic-framework-golang-untuk-rest-api" id="toc-pengenalan-gin-gonic-framework-golang-untuk-rest-api" class="nav-link" data-scroll-target="#pengenalan-gin-gonic-framework-golang-untuk-rest-api"><span class="header-section-number">3</span> Pengenalan Gin Gonic (Framework Golang untuk REST API)</a>
  <ul class="collapse">
  <li><a href="#apa-itu-gin-gonic" id="toc-apa-itu-gin-gonic" class="nav-link" data-scroll-target="#apa-itu-gin-gonic"><span class="header-section-number">3.1</span> Apa itu Gin Gonic?</a></li>
  <li><a href="#mengapa-menggunakan-gin" id="toc-mengapa-menggunakan-gin" class="nav-link" data-scroll-target="#mengapa-menggunakan-gin"><span class="header-section-number">3.2</span> Mengapa menggunakan Gin?</a></li>
  <li><a href="#perbedaan-gin-dengan-http-server-golang-standar" id="toc-perbedaan-gin-dengan-http-server-golang-standar" class="nav-link" data-scroll-target="#perbedaan-gin-dengan-http-server-golang-standar"><span class="header-section-number">3.3</span> Perbedaan Gin dengan HTTP Server Golang Standar</a></li>
  </ul></li>
  <li><a href="#middleware" id="toc-middleware" class="nav-link" data-scroll-target="#middleware"><span class="header-section-number">4</span> Middleware</a>
  <ul class="collapse">
  <li><a href="#pengertian" id="toc-pengertian" class="nav-link" data-scroll-target="#pengertian"><span class="header-section-number">4.1</span> Pengertian</a></li>
  <li><a href="#kenapa-menggunakan-middleware" id="toc-kenapa-menggunakan-middleware" class="nav-link" data-scroll-target="#kenapa-menggunakan-middleware"><span class="header-section-number">4.2</span> Kenapa menggunakan Middleware?</a></li>
  <li><a href="#cara-kerja-middleware" id="toc-cara-kerja-middleware" class="nav-link" data-scroll-target="#cara-kerja-middleware"><span class="header-section-number">4.3</span> Cara Kerja Middleware</a></li>
  <li><a href="#contoh-middleware" id="toc-contoh-middleware" class="nav-link" data-scroll-target="#contoh-middleware"><span class="header-section-number">4.4</span> Contoh Middleware</a></li>
  </ul></li>
  <li><a href="#authorisasi-dan-authentikasi" id="toc-authorisasi-dan-authentikasi" class="nav-link" data-scroll-target="#authorisasi-dan-authentikasi"><span class="header-section-number">5</span> Authorisasi dan Authentikasi</a>
  <ul class="collapse">
  <li><a href="#jwt-json-web-token" id="toc-jwt-json-web-token" class="nav-link" data-scroll-target="#jwt-json-web-token"><span class="header-section-number">5.1</span> JWT JSON Web Token</a>
  <ul class="collapse">
  <li><a href="#anatomi" id="toc-anatomi" class="nav-link" data-scroll-target="#anatomi"><span class="header-section-number">5.1.1</span> Anatomi</a></li>
  <li><a href="#flow" id="toc-flow" class="nav-link" data-scroll-target="#flow"><span class="header-section-number">5.1.2</span> Flow</a></li>
  <li><a href="#jwt-implementation" id="toc-jwt-implementation" class="nav-link" data-scroll-target="#jwt-implementation"><span class="header-section-number">5.1.3</span> JWT implementation</a></li>
  </ul></li>
  <li><a href="#oauth" id="toc-oauth" class="nav-link" data-scroll-target="#oauth"><span class="header-section-number">5.2</span> OAuth</a>
  <ul class="collapse">
  <li><a href="#pengertian-1" id="toc-pengertian-1" class="nav-link" data-scroll-target="#pengertian-1"><span class="header-section-number">5.2.1</span> Pengertian</a></li>
  <li><a href="#why-oauth" id="toc-why-oauth" class="nav-link" data-scroll-target="#why-oauth"><span class="header-section-number">5.2.2</span> Why OAuth?</a></li>
  <li><a href="#basic-flow" id="toc-basic-flow" class="nav-link" data-scroll-target="#basic-flow"><span class="header-section-number">5.2.3</span> Basic Flow</a></li>
  <li><a href="#implementasi-oauth" id="toc-implementasi-oauth" class="nav-link" data-scroll-target="#implementasi-oauth"><span class="header-section-number">5.2.4</span> Implementasi OAuth</a></li>
  </ul></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="index.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li><li><a href="index.docx"><i class="bi bi-file-word"></i>MS Word</a></li></ul></div></nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Pemrograman Golang Web dan API</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Aditya Rizky Ramadhan </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="clean-architecture" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Clean Architecture</h1>
<section id="pengertian-clean-architecture" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="pengertian-clean-architecture"><span class="header-section-number">1.1</span> Pengertian Clean Architecture</h2>
<p>Clean Architecture adalah desain software yang memisahkan elemen-elemen menjadi beberapa lapisan (layer). Tujuan penting dari Clean Architecture adalah memisahkan antara layer business logic dan layer presentasi (delivery mechanism).</p>
<p><strong>Keuntungan Clean Architecture:</strong></p>
<ul>
<li><p><strong>Highly Testable:</strong> kita dapat membuat test cases untuk setiap layer guna menentukan di mana error terjadi.</p></li>
<li><p><strong>Framework Independent:</strong> Clean architecture tidak menggunakan framework atau tergantung pada framework tertentu, jadi kita bisa mengubah framework kapan saja.</p></li>
<li><p><strong>Database Independent:</strong> memungkinkan kita mengganti database tanpa membuat perubahan besar pada source code, misalnya dari SQL ke database NoSQL.</p></li>
<li><p><strong>UI Independent:</strong> UI framework ada di layer terluar dan kita dapat mengubahnya dengan mudah karena sudah terpisah.</p></li>
</ul>
</section>
<section id="penerapan-clean-architecture" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="penerapan-clean-architecture"><span class="header-section-number">1.2</span> Penerapan Clean Architecture</h2>
<p><strong>MVC</strong></p>
<p>Model Clean Architecture yang paling sering digunakan adalah model MVC (Model View Controller), yaitu sebuah pola arsitektur dalam membuat sebuah aplikasi dengan cara memisahkan kode menjadi tiga bagian yang terdiri dari</p>
<ul>
<li><p><strong>Model:</strong> bagian yang berhubungan dengan data, biasanya berisi class yang berhubungan dengan database.</p></li>
<li><p><strong>View:</strong> bagian yang berhubungan dengan tampilan, biasanya berisi file HTML, CSS, dan Javascript.</p></li>
<li><p><strong>Controller:</strong> bagian yang berhubungan dengan logika aplikasi, biasanya berisi class yang mengatur alur aplikasi.</p></li>
</ul>
<p><strong>Layer MVC</strong></p>
<p>./app</p>
<p>├── controller</p>
<p>│ └── userController.go</p>
<p>├── model</p>
<p>│ └── user.go</p>
<p>├── repository</p>
<p>│ └── userRepo.go</p>
<p>├── view</p>
<p>│ └── userView.go</p>
<p>Ini adalah tata letak yang paling umum dalam implementasi MVC di mana kita memisahkan resource berdasarkan layer MVC, biasanya digunakan pada aplikasi yang belum terlalu kompleks.</p>
</section>
</section>
<section id="rest-api" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> REST API</h1>
<section id="pengertian-api" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="pengertian-api"><span class="header-section-number">2.1</span> Pengertian API</h2>
<p>API (Application Programming Interface) merupakan interface yang dapat menghubungkan satu aplikasi dengan aplikasi lainnya. Berperan sebagai perantara antar berbagai aplikasi berbeda, baik dalam satu platform yang sama atau lintas platform.</p>
<p>Perumpamaan yang bisa digunakan untuk menjelaskan API adalah seorang pelayan di restoran. Tugas pelayan tersebut adalah menghubungkan tamu restoran (client) dengan juru masak (server).</p>
<p>Jadi, tamu cukup memesan makanan sesuai daftar menu yang ada dan pelayan memberitahukannya ke juru masak. Nantinya, pelayan akan kembali ke tamu tadi dengan masakan yang sudah siap sesuai pesanan.</p>
<p><img src="ilustrasi_api.png" class="img-fluid"></p>
</section>
<section id="pengertian-rest" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="pengertian-rest"><span class="header-section-number">2.2</span> Pengertian REST</h2>
<p>REST (REpresentational State Transfer) API adalah arsitektur perangkat lunak yang di dalamnya mendefinisikan aturan-aturan untuk membuat web service.</p>
<p>API dapat dikatakan “RESTful” jika memiliki fitur berikut :</p>
<ul>
<li><p><strong>Client-Server:</strong> REST memisahkan antara client dan server, sehingga keduanya dapat berkembang secara independen.</p></li>
<li><p><strong>Stateless:</strong> Setiap request dari client ke server harus berisi semua informasi yang diperlukan untuk memahami request tersebut.</p></li>
<li><p><strong>Cacheable:</strong> Server harus menandai data sebagai cacheable atau non-cacheable.</p></li>
</ul>
</section>
<section id="why-use-restful-api" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="why-use-restful-api"><span class="header-section-number">2.3</span> Why use RESTful API?</h2>
<ul>
<li><p><strong>Skalabilitas:</strong> Sistem yang menerapkan REST API dapat menskalakan secara efisien karena REST mengoptimalkan interaksi client-server. Statelessness menghapus beban server karena server tidak perlu menyimpan informasi request client di masa lalu. Dan pembuatan cache yang dikelola dengan baik di sisi client. Semua fitur ini mendukung skalabilitas tanpa menyebabkan gangguan komunikasi yang mengurangi performa.</p></li>
<li><p><strong>Fleksibilitas:</strong> Layanan web RESTful menyederhanakan dan memisahkan berbagai komponen server sehingga masing-masing bagian dapat berkembang secara mandiri. Perubahan platform atau teknologi pada aplikasi server tidak mempengaruhi aplikasi client.</p></li>
<li><p><strong>Independensi:</strong> Implementasi API menggunakan REST bersifat independen terhadap teknologi yang digunakan. Kita dapat menulis baik aplikasi client dan server dalam berbagai bahasa pemrograman tanpa mempengaruhi desain API. Kita juga dapat mengubah teknologi mendasar di kedua sisi tanpa mempengaruhi komunikasi.</p></li>
</ul>
</section>
</section>
<section id="pengenalan-gin-gonic-framework-golang-untuk-rest-api" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Pengenalan Gin Gonic (Framework Golang untuk REST API)</h1>
<section id="apa-itu-gin-gonic" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="apa-itu-gin-gonic"><span class="header-section-number">3.1</span> Apa itu Gin Gonic?</h2>
<p>Gin adalah framework yang dikembangkan oleh komunitas Golang. Gin dibuat untuk memudahkan pengembangan aplikasi web. Sebelumnya kita sudah belajar tentang HTTP server Golang standar, dengan menggunakan Gin kita dapat membuat aplikasi web dengan lebih cepat dan mudah karena memiliki banyak fitur yang dapat memudahkan pengembangan aplikasi web. Dokumentasi resmi dari Gin dapat dilihat di <a href="https://github.com/gin-gonic/gin">sini</a>.</p>
</section>
<section id="mengapa-menggunakan-gin" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="mengapa-menggunakan-gin"><span class="header-section-number">3.2</span> Mengapa menggunakan Gin?</h2>
<p>Cara kerja Gin sama seperti HTTP server Golang standar, hanya saja Gin memiliki beberapa kelebihan dibandingkan dengan HTTP server Golang standar, yaitu:</p>
<p>Jika menggunakan HTTP server, tidak ada built-in support di Golang untuk mengatasi routing berdasarkan regular expression atau “pattern”.</p>
<ul>
<li><p>Gin memiliki performa yang lebih baik dan efisien dibandingkan dengan HTTP server Golang standar, karena Gin menggunakan routing yang lebih cepat dan memiliki arsitektur yang lebih baik untuk memproses request.</p></li>
<li><p>Gin menyediakan fitur middleware, yang memudahkan pengembangan aplikasi web dengan menambahkan logika pada tahap-tahap tertentu dalam proses request-response (ini akan dijelaskan di materi selanjutnya).</p></li>
<li><p>Gin memiliki komunitas yang aktif dan membantu, memudahkan pengembangan aplikasi web dan mempercepat proses pemecahan masalah.</p></li>
</ul>
</section>
<section id="perbedaan-gin-dengan-http-server-golang-standar" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="perbedaan-gin-dengan-http-server-golang-standar"><span class="header-section-number">3.3</span> Perbedaan Gin dengan HTTP Server Golang Standar</h2>
<p>Kode HTTP server Golang standar:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode go code-with-copy"><code class="sourceCode go"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">package</span> main</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="op">(</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"fmt"</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"net/http"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> Handler<span class="op">(</span>w http<span class="op">.</span>ResponseWriter<span class="op">,</span> r <span class="op">*</span>http<span class="op">.</span>Request<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// handle only get request</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> r<span class="op">.</span>Method <span class="op">!=</span> http<span class="op">.</span>MethodGet <span class="op">{</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>        w<span class="op">.</span>WriteHeader<span class="op">(</span>http<span class="op">.</span>StatusMethodNotAllowed<span class="op">)</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    w<span class="op">.</span>WriteHeader<span class="op">(</span>http<span class="op">.</span>StatusOK<span class="op">)</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    fmt<span class="op">.</span>Fprintf<span class="op">(</span>w<span class="op">,</span> <span class="st">`{"message": "Hello World"}`</span><span class="op">)</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    mux <span class="op">:=</span> http<span class="op">.</span>NewServeMux<span class="op">()</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    mux<span class="op">.</span>HandleFunc<span class="op">(</span><span class="st">"/hello"</span><span class="op">,</span> Handler<span class="op">)</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    http<span class="op">.</span>ListenAndServe<span class="op">(</span><span class="st">":8080"</span><span class="op">,</span> mux<span class="op">)</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Kode HTTP server menggunakan Gin:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode go code-with-copy"><code class="sourceCode go"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">package</span> main</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="op">(</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"github.com/gin-gonic/gin"</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    r <span class="op">:=</span> gin<span class="op">.</span>Default<span class="op">()</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    r<span class="op">.</span>GET<span class="op">(</span><span class="st">"/hello"</span><span class="op">,</span> <span class="kw">func</span><span class="op">(</span>c <span class="op">*</span>gin<span class="op">.</span>Context<span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>        c<span class="op">.</span>JSON<span class="op">(</span>http<span class="op">.</span>StatusOK<span class="op">,</span> gin<span class="op">.</span>H<span class="op">{</span> <span class="st">"message"</span><span class="op">:</span> <span class="st">"Hello World"</span> <span class="op">})</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">})</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    r<span class="op">.</span>Run<span class="op">(</span><span class="st">":8080"</span><span class="op">)</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Dari kedua kode di atas, kita dapat melihat perbedaan antara HTTP server Golang standar dan Gin. Gin memiliki fitur yang lebih lengkap dan mudah digunakan, sehingga memudahkan pengembangan aplikasi web.</p>
<p>Untuk latihan menggunakan golang dapat dilihat di <a href="https://github.com/adityarizkyramadhan/Pemrograman-Web-Golang/tree/main/web-app-assignment-1-v2">sini</a></p>
</section>
</section>
<section id="middleware" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Middleware</h1>
<section id="pengertian" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="pengertian"><span class="header-section-number">4.1</span> Pengertian</h2>
<p>Middleware adalah sekumpulan logika yang berjalan di antara request dan response dalam aplikasi web. Dalam Golang, middleware dapat diterapkan pada sebuah web server untuk memproses serangkaian request sebelum diarahkan ke handler utama. Dalam satu aplikasi bisa terdapat lebih dari satu middleware, sehingga request akan dijalankan melalui beberapa middleware secara berurutan sebelum sampai ke handler utama.</p>
<p><code>request =&gt; middleware 1 =&gt; middleware 2 =&gt; middleware ... =&gt; handler =&gt; response</code></p>
</section>
<section id="kenapa-menggunakan-middleware" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="kenapa-menggunakan-middleware"><span class="header-section-number">4.2</span> Kenapa menggunakan Middleware?</h2>
<p>Middleware memudahkan web server untuk mengelola &amp; memproses request dan response dengan lebih efisien dan efektif. Middleware juga dapat memfasilitasi integrasi antara aplikasi web dengan sistem lain seperti database, sistem pembayaran, dan lainnya. Oleh karena itu, middleware di web server sangat penting untuk memastikan bahwa aplikasi web berjalan dengan baik dan aman.</p>
<p>Middleware juga dapat meng-handle beberapa kasus sejenis menjadi satu. Misalnya, kita memiliki beberapa route yang membutuhkan autentikasi. Kita bisa membuat middleware untuk melakukan autentikasi dan menambahkan middleware tersebut ke setiap route yang membutuhkan autentikasi. Dengan begitu, kita tidak perlu menulis ulang kode autentikasi untuk setiap route yang membutuhkan autentikasi.</p>
<p>Secara umum, middleware sering digunakan untuk kasus autentikasi dan otorisasi. Middleware juga dapat digunakan untuk melakukan tugas seperti enkripsi, caching, kompresi, integrasi dengan sistem lain, manajemen sesi, dan load balancing.</p>
</section>
<section id="cara-kerja-middleware" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="cara-kerja-middleware"><span class="header-section-number">4.3</span> Cara Kerja Middleware</h2>
<p><img src="image-middleware.png" class="img-fluid"></p>
<p>Arsitektur middleware terdiri dari tiga komponen utama: client, web server, dan middleware:</p>
<ul>
<li><p>Client: Client (Klien) adalah perangkat yang mengirimkan permintaan ke web server, misalnya browser web.</p></li>
<li><p>Server: Server atau Web Server adalah sistem yang menerima permintaan dari klien dan mengirimkan respons yang sesuai.</p></li>
<li><p>Middleware: Middleware adalah perantara antara klien dan web server yang memproses permintaan dari klien, memvalidasi autentikasi dan otorisasi, dan mengirimkan respons yang sesuai. Middleware juga dapat menambahkan fitur tambahan seperti enkripsi, caching, dan kompresi.</p></li>
</ul>
<p><img src="image-middleware-2.png" class="img-fluid"></p>
<p>Untuk middleware yang lebih dari 1 (middleware chain), klien mengirimkan permintaan ke middleware pertama. Middleware pertama memproses permintaan dan mengirimkan permintaan yang valid ke middleware kedua. Middleware kedua memproses permintaan dan mengirimkan permintaan yang valid ke middleware ketiga. Dan seterusnya sampai middleware terakhir.</p>
<p>Middleware terakhir mengirimkan permintaan yang valid ke web server. Web server mengirimkan respons kembali ke middleware terakhir, dan kemudian berlanjut sampai ke middleware awal. Terakhir, hasil response dari middleware awal di kirimkan ke klien.</p>
<p>Pada setiap middleware, dapat berisi logic sebelum diarahkan ke middleware selanjutnya. Logic ini disebut middleware logic before. Kemudian, middleware juga dapat berisi logic setelah middleware mendapatkan response dari web server. Logic ini disebut middleware logic after. Untuk lebih jelasnya dapat dilihat pada gambar di atas.</p>
</section>
<section id="contoh-middleware" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="contoh-middleware"><span class="header-section-number">4.4</span> Contoh Middleware</h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode go code-with-copy"><code class="sourceCode go"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">package</span> main</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="op">(</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"github.com/gin-gonic/gin"</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"net/http"</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    r <span class="op">:=</span> gin<span class="op">.</span>Default<span class="op">()</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Middleware</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    r<span class="op">.</span>Use<span class="op">(</span><span class="kw">func</span><span class="op">(</span>c <span class="op">*</span>gin<span class="op">.</span>Context<span class="op">)</span> <span class="op">{</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>        c<span class="op">.</span>JSON<span class="op">(</span>http<span class="op">.</span>StatusOK<span class="op">,</span> gin<span class="op">.</span>H<span class="op">{</span> <span class="st">"message"</span><span class="op">:</span> <span class="st">"Middleware Logic Before"</span> <span class="op">})</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>        c<span class="op">.</span>Next<span class="op">()</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>        c<span class="op">.</span>JSON<span class="op">(</span>http<span class="op">.</span>StatusOK<span class="op">,</span> gin<span class="op">.</span>H<span class="op">{</span> <span class="st">"message"</span><span class="op">:</span> <span class="st">"Middleware Logic After"</span> <span class="op">})</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">})</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    r<span class="op">.</span>GET<span class="op">(</span><span class="st">"/hello"</span><span class="op">,</span> <span class="kw">func</span><span class="op">(</span>c <span class="op">*</span>gin<span class="op">.</span>Context<span class="op">)</span> <span class="op">{</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>        c<span class="op">.</span>JSON<span class="op">(</span>http<span class="op">.</span>StatusOK<span class="op">,</span> gin<span class="op">.</span>H<span class="op">{</span> <span class="st">"message"</span><span class="op">:</span> <span class="st">"Hello World"</span> <span class="op">})</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">})</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    r<span class="op">.</span>Run<span class="op">(</span><span class="st">":8080"</span><span class="op">)</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Pada contoh kode di atas, kita membuat middleware yang berisi logic sebelum dan sesudah request diarahkan ke handler. Logic sebelum request diarahkan ke handler berada di dalam blok <code>c.Next()</code>, sedangkan logic setelah request diarahkan ke handler berada di luar blok <code>c.Next()</code>.</p>
<p>Untuk latihan menggunakan golang dapat dilihat di <a href="https://github.com/adityarizkyramadhan/Pemrograman-Web-Golang/tree/main/web-app-assignment-2-v2">sini</a></p>
</section>
</section>
<section id="authorisasi-dan-authentikasi" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Authorisasi dan Authentikasi</h1>
<section id="jwt-json-web-token" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="jwt-json-web-token"><span class="header-section-number">5.1</span> JWT JSON Web Token</h2>
<p>JWT (JSON Web Token) adalah jenis token yang digunakan untuk mengidentifikasi user yang telah login pada aplikasi. Token ini berisi informasi tentang user dengan format JSON yang dienkripsi menggunakan algoritma tertentu dan dapat dibaca oleh server untuk memverifikasi identitas user dengan mudah tanpa harus menyimpan informasi sensitif mengenai login di server.</p>
<p>Banyak developer memilih menggunakan JWT dalam aplikasi mereka karena memudahkan pengelolaan user session, proses autentikasi dan otorisasi user lebih mudah diimplementasikan, dan membuat verifikasi lebih cepat dan efisien.</p>
<p>Biasanya token di kirim oleh client melalui header Authorization menggunakan skema Bearer yang akan terlihat seperti berikut:</p>
<p><code>Authorization: Bearer &lt;token&gt;</code></p>
<p>Selain itu, token juga bisa disimpan menggunakan cookie.</p>
<section id="anatomi" class="level3" data-number="5.1.1">
<h3 data-number="5.1.1" class="anchored" data-anchor-id="anatomi"><span class="header-section-number">5.1.1</span> Anatomi</h3>
<p>Anatomi JWT terdiri dari tiga bagian yang dipisahkan oleh titik (.), yaitu:</p>
<ul>
<li><p>Header: Bagian pertama dari JWT yang berisi informasi tentang algoritma enkripsi yang digunakan dan tipe token.</p></li>
<li><p>Payload: Bagian kedua dari JWT yang berisi informasi user yang dienkripsi.</p></li>
<li><p>Signature: Bagian terakhir dari JWT yang berisi tanda tangan digital yang digunakan untuk memverifikasi keaslian token.</p></li>
</ul>
<p><img src="image.png" class="img-fluid"></p>
</section>
<section id="flow" class="level3" data-number="5.1.2">
<h3 data-number="5.1.2" class="anchored" data-anchor-id="flow"><span class="header-section-number">5.1.2</span> Flow</h3>
<p>Flow penggunaan JWT pada browser dan server dibagi menjadi beberapa tahap:</p>
<ul>
<li><p>Autentikasi: user melakukan login dengan mengirimkan informasi pengidentifikasi (seperti username dan password) ke server. Jika informasi pengidentifikasi benar, server akan mengeluarkan JWT yang berisi informasi user.</p></li>
<li><p>Penyimpanan JWT: JWT yang diterima dari server disimpan dalam browser, biasanya dalam browser storage seperti local storage atau cookie.</p></li>
<li><p>Autentikasi pada request: Setiap kali user mengirimkan request ke server, JWT disertakan dalam request sebagai header autentikasi. Server mengecek validitas JWT dan mengekstrak informasi user dari token.</p></li>
</ul>
<p><img src="image-1.png" class="img-fluid"></p>
</section>
<section id="jwt-implementation" class="level3" data-number="5.1.3">
<h3 data-number="5.1.3" class="anchored" data-anchor-id="jwt-implementation"><span class="header-section-number">5.1.3</span> JWT implementation</h3>
<p>Untuk mengimplementasikan JWT menggunakan Golang kamu bisa melihat dokumentasi JWT Libraries dalam bahasa pemrograman Go. Di sana akan ditampilkan beberapa library yang tersedia untuk digunakan dalam aplikasi Go untuk menangani JWT, seperti mengeluarkan, memvalidasi, dan membuat JWT. Bisa dilihat di <a href="https://jwt.io/">sini</a></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode go code-with-copy"><code class="sourceCode go"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">package</span> main</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="op">(</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"encoding/json"</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"fmt"</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"log"</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"net/http"</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"time"</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"github.com/golang-jwt/jwt/v4"</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co">// JWT key: dipakai untuk membuat signature JWT token.</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> jwtKey <span class="op">=</span> <span class="op">[]</span><span class="dt">byte</span><span class="op">(</span><span class="st">"secret-key"</span><span class="op">)</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co">// Data key: user, password, role yang bisa digunakan untuk mengakses API</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> users <span class="op">=</span> <span class="kw">map</span><span class="op">[</span><span class="dt">string</span><span class="op">]*</span>User<span class="op">{</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"aditira"</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>        Password<span class="op">:</span> <span class="st">"password1"</span><span class="op">,</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>        Role<span class="op">:</span>     <span class="st">"admin"</span><span class="op">,</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"dito"</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>        Password<span class="op">:</span> <span class="st">"password2"</span><span class="op">,</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>        Role<span class="op">:</span>     <span class="st">"student"</span><span class="op">,</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> User <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>    Password <span class="dt">string</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>    Role     <span class="dt">string</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a><span class="co">// Struct untuk membaca request body JSON</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> Credentials <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>    Password <span class="dt">string</span> <span class="st">`json:"password"`</span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>    Username <span class="dt">string</span> <span class="st">`json:"username"`</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a><span class="co">// Struct Claims digunakan sebagai object yang akan di encode atau di parse oleh JWT</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a><span class="co">// jwt.StandardClaims ditambahkan sebagai embedded type untuk memudahkan proses encoding, parsing dan validasi JWT</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> Claims <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>    Username <span class="dt">string</span> <span class="st">`json:"username"`</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>    Role     <span class="dt">string</span> <span class="st">`json:"role"`</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>    jwt<span class="op">.</span>StandardClaims</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>    fmt<span class="op">.</span>Println<span class="op">(</span><span class="st">"Starting Server at port :8080"</span><span class="op">)</span></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>    log<span class="op">.</span>Fatal<span class="op">(</span>http<span class="op">.</span>ListenAndServe<span class="op">(</span><span class="st">":8080"</span><span class="op">,</span> Routes<span class="op">()))</span></span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> Routes<span class="op">()</span> <span class="op">*</span>http<span class="op">.</span>ServeMux <span class="op">{</span></span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>    mux <span class="op">:=</span> http<span class="op">.</span>NewServeMux<span class="op">()</span></span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>    mux<span class="op">.</span>HandleFunc<span class="op">(</span><span class="st">"/login"</span><span class="op">,</span> <span class="kw">func</span><span class="op">(</span>w http<span class="op">.</span>ResponseWriter<span class="op">,</span> r <span class="op">*</span>http<span class="op">.</span>Request<span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> creds Credentials</span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>        <span class="co">// JSON body diconvert menjadi credential struct &amp; return bad request ketika terjadi kesalahan saat proses decoding json</span></span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>        err <span class="op">:=</span> json<span class="op">.</span>NewDecoder<span class="op">(</span>r<span class="op">.</span>Body<span class="op">).</span>Decode<span class="op">(&amp;</span>creds<span class="op">)</span></span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> err <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>            w<span class="op">.</span>WriteHeader<span class="op">(</span>http<span class="op">.</span>StatusBadRequest<span class="op">)</span></span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Cek apakah username dan password ada dan sesuai dengan yang ada di Data Key &amp; return unauthorized jika password salah</span></span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a>        expectedPassword<span class="op">,</span> ok <span class="op">:=</span> users<span class="op">[</span>creds<span class="op">.</span>Username<span class="op">]</span></span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">!</span>ok <span class="op">||</span> expectedPassword<span class="op">.</span>Password <span class="op">!=</span> creds<span class="op">.</span>Password <span class="op">{</span></span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>            w<span class="op">.</span>WriteHeader<span class="op">(</span>http<span class="op">.</span>StatusUnauthorized<span class="op">)</span></span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Deklarasi expiry time untuk token jwt</span></span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a>        expirationTime <span class="op">:=</span> time<span class="op">.</span>Now<span class="op">().</span>Add<span class="op">(</span><span class="dv">5</span> <span class="op">*</span> time<span class="op">.</span>Minute<span class="op">)</span></span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Buat claims berisi data username dan role yang akan kita embed ke JWT</span></span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a>        claims <span class="op">:=</span> <span class="op">&amp;</span>Claims<span class="op">{</span></span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a>        Username<span class="op">:</span> creds<span class="op">.</span>Username<span class="op">,</span></span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a>        Role<span class="op">:</span>     expectedPassword<span class="op">.</span>Role<span class="op">,</span></span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a>        StandardClaims<span class="op">:</span> jwt<span class="op">.</span>StandardClaims<span class="op">{</span></span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a>                <span class="co">// expiry time menggunakan time millisecond</span></span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a>                ExpiresAt<span class="op">:</span> expirationTime<span class="op">.</span>Unix<span class="op">(),</span></span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a>            <span class="op">},</span></span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Buat token menggunakan encoded claim dengan salah satu algoritma yang dipakai</span></span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a>        token <span class="op">:=</span> jwt<span class="op">.</span>NewWithClaims<span class="op">(</span>jwt<span class="op">.</span>SigningMethodHS256<span class="op">,</span> claims<span class="op">)</span></span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Buat JWT string dari token yang sudah dibuat menggunakan JWT key yang telah dideklarasikan (proses encoding JWT)</span></span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a>        tokenString<span class="op">,</span> err <span class="op">:=</span> token<span class="op">.</span>SignedString<span class="op">(</span>jwtKey<span class="op">)</span></span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> err <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true" tabindex="-1"></a>            <span class="co">// return internal error ketika ada kesalahan saat pembuatan JWT string</span></span>
<span id="cb4-91"><a href="#cb4-91" aria-hidden="true" tabindex="-1"></a>            w<span class="op">.</span>WriteHeader<span class="op">(</span>http<span class="op">.</span>StatusInternalServerError<span class="op">)</span></span>
<span id="cb4-92"><a href="#cb4-92" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb4-93"><a href="#cb4-93" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb4-94"><a href="#cb4-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-95"><a href="#cb4-95" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Set token string ke dalam cookie response</span></span>
<span id="cb4-96"><a href="#cb4-96" aria-hidden="true" tabindex="-1"></a>        http<span class="op">.</span>SetCookie<span class="op">(</span>w<span class="op">,</span> <span class="op">&amp;</span>http<span class="op">.</span>Cookie<span class="op">{</span></span>
<span id="cb4-97"><a href="#cb4-97" aria-hidden="true" tabindex="-1"></a>            Name<span class="op">:</span>    <span class="st">"token"</span><span class="op">,</span></span>
<span id="cb4-98"><a href="#cb4-98" aria-hidden="true" tabindex="-1"></a>            Value<span class="op">:</span>   tokenString<span class="op">,</span></span>
<span id="cb4-99"><a href="#cb4-99" aria-hidden="true" tabindex="-1"></a>            Expires<span class="op">:</span> expirationTime<span class="op">,</span></span>
<span id="cb4-100"><a href="#cb4-100" aria-hidden="true" tabindex="-1"></a>        <span class="op">})</span></span>
<span id="cb4-101"><a href="#cb4-101" aria-hidden="true" tabindex="-1"></a>    <span class="op">})</span></span>
<span id="cb4-102"><a href="#cb4-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-103"><a href="#cb4-103" aria-hidden="true" tabindex="-1"></a>    <span class="co">// halaman /admin hanya dapat diakses oleh user yang sudah diotentikasi dan memiliki role admin</span></span>
<span id="cb4-104"><a href="#cb4-104" aria-hidden="true" tabindex="-1"></a>    mux<span class="op">.</span>HandleFunc<span class="op">(</span><span class="st">"/admin"</span><span class="op">,</span> <span class="kw">func</span><span class="op">(</span>w http<span class="op">.</span>ResponseWriter<span class="op">,</span> r <span class="op">*</span>http<span class="op">.</span>Request<span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-105"><a href="#cb4-105" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Ambil token dari cookie yang di kirim ketika request</span></span>
<span id="cb4-106"><a href="#cb4-106" aria-hidden="true" tabindex="-1"></a>        c<span class="op">,</span> err <span class="op">:=</span> r<span class="op">.</span>Cookie<span class="op">(</span><span class="st">"token"</span><span class="op">)</span></span>
<span id="cb4-107"><a href="#cb4-107" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> err <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb4-108"><a href="#cb4-108" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> err <span class="op">==</span> http<span class="op">.</span>ErrNoCookie <span class="op">{</span></span>
<span id="cb4-109"><a href="#cb4-109" aria-hidden="true" tabindex="-1"></a>                <span class="co">// return unauthorized ketika token kosong</span></span>
<span id="cb4-110"><a href="#cb4-110" aria-hidden="true" tabindex="-1"></a>                w<span class="op">.</span>WriteHeader<span class="op">(</span>http<span class="op">.</span>StatusUnauthorized<span class="op">)</span></span>
<span id="cb4-111"><a href="#cb4-111" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb4-112"><a href="#cb4-112" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb4-113"><a href="#cb4-113" aria-hidden="true" tabindex="-1"></a>            <span class="co">// return bad request ketika field token tidak ada</span></span>
<span id="cb4-114"><a href="#cb4-114" aria-hidden="true" tabindex="-1"></a>            w<span class="op">.</span>WriteHeader<span class="op">(</span>http<span class="op">.</span>StatusBadRequest<span class="op">)</span></span>
<span id="cb4-115"><a href="#cb4-115" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb4-116"><a href="#cb4-116" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb4-117"><a href="#cb4-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-118"><a href="#cb4-118" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Ambil value dari cookie token</span></span>
<span id="cb4-119"><a href="#cb4-119" aria-hidden="true" tabindex="-1"></a>        tknStr <span class="op">:=</span> c<span class="op">.</span>Value</span>
<span id="cb4-120"><a href="#cb4-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-121"><a href="#cb4-121" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Deklarasi variable claims yang akan kita isi dengan data hasil parsing JWT</span></span>
<span id="cb4-122"><a href="#cb4-122" aria-hidden="true" tabindex="-1"></a>        claims <span class="op">:=</span> <span class="op">&amp;</span>Claims<span class="op">{}</span></span>
<span id="cb4-123"><a href="#cb4-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-124"><a href="#cb4-124" aria-hidden="true" tabindex="-1"></a>        <span class="co">// parse JWT token ke dalam claims</span></span>
<span id="cb4-125"><a href="#cb4-125" aria-hidden="true" tabindex="-1"></a>        tkn<span class="op">,</span> err <span class="op">:=</span> jwt<span class="op">.</span>ParseWithClaims<span class="op">(</span>tknStr<span class="op">,</span> claims<span class="op">,</span> <span class="kw">func</span><span class="op">(</span>token <span class="op">*</span>jwt<span class="op">.</span>Token<span class="op">)</span> <span class="op">(</span><span class="kw">interface</span><span class="op">{},</span> <span class="dt">error</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-126"><a href="#cb4-126" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> jwtKey<span class="op">,</span> <span class="ot">nil</span></span>
<span id="cb4-127"><a href="#cb4-127" aria-hidden="true" tabindex="-1"></a>        <span class="op">})</span></span>
<span id="cb4-128"><a href="#cb4-128" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> err <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb4-129"><a href="#cb4-129" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> err <span class="op">==</span> jwt<span class="op">.</span>ErrSignatureInvalid <span class="op">{</span></span>
<span id="cb4-130"><a href="#cb4-130" aria-hidden="true" tabindex="-1"></a>                <span class="co">// return unauthorized ketika ada kesalahan saat parsing token</span></span>
<span id="cb4-131"><a href="#cb4-131" aria-hidden="true" tabindex="-1"></a>                w<span class="op">.</span>WriteHeader<span class="op">(</span>http<span class="op">.</span>StatusUnauthorized<span class="op">)</span></span>
<span id="cb4-132"><a href="#cb4-132" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb4-133"><a href="#cb4-133" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb4-134"><a href="#cb4-134" aria-hidden="true" tabindex="-1"></a>            <span class="co">// return bad request ketika field token tidak ada</span></span>
<span id="cb4-135"><a href="#cb4-135" aria-hidden="true" tabindex="-1"></a>            w<span class="op">.</span>WriteHeader<span class="op">(</span>http<span class="op">.</span>StatusBadRequest<span class="op">)</span></span>
<span id="cb4-136"><a href="#cb4-136" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb4-137"><a href="#cb4-137" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb4-138"><a href="#cb4-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-139"><a href="#cb4-139" aria-hidden="true" tabindex="-1"></a>        <span class="co">//return unauthorized ketika token sudah tidak valid (biasanya karena token expired)</span></span>
<span id="cb4-140"><a href="#cb4-140" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">!</span>tkn<span class="op">.</span>Valid <span class="op">{</span></span>
<span id="cb4-141"><a href="#cb4-141" aria-hidden="true" tabindex="-1"></a>            w<span class="op">.</span>WriteHeader<span class="op">(</span>http<span class="op">.</span>StatusUnauthorized<span class="op">)</span></span>
<span id="cb4-142"><a href="#cb4-142" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb4-143"><a href="#cb4-143" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb4-144"><a href="#cb4-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-145"><a href="#cb4-145" aria-hidden="true" tabindex="-1"></a>        <span class="co">//return unauthorized ketika role user tidak sesuai dengan role admin</span></span>
<span id="cb4-146"><a href="#cb4-146" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> claims<span class="op">.</span>Role <span class="op">!=</span> <span class="st">"admin"</span> <span class="op">{</span></span>
<span id="cb4-147"><a href="#cb4-147" aria-hidden="true" tabindex="-1"></a>            w<span class="op">.</span>WriteHeader<span class="op">(</span>http<span class="op">.</span>StatusUnauthorized<span class="op">)</span></span>
<span id="cb4-148"><a href="#cb4-148" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb4-149"><a href="#cb4-149" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb4-150"><a href="#cb4-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-151"><a href="#cb4-151" aria-hidden="true" tabindex="-1"></a>        <span class="co">// return data dalam claims, yaitu username yang telah didefinisikan di variable claims</span></span>
<span id="cb4-152"><a href="#cb4-152" aria-hidden="true" tabindex="-1"></a>        w<span class="op">.</span>Write<span class="op">([]</span><span class="dt">byte</span><span class="op">(</span>fmt<span class="op">.</span>Sprintf<span class="op">(</span><span class="st">"Welcome Admin %s!"</span><span class="op">,</span> claims<span class="op">.</span>Username<span class="op">)))</span></span>
<span id="cb4-153"><a href="#cb4-153" aria-hidden="true" tabindex="-1"></a>    <span class="op">})</span></span>
<span id="cb4-154"><a href="#cb4-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-155"><a href="#cb4-155" aria-hidden="true" tabindex="-1"></a>    <span class="co">// halaman /profile dapat diakses oleh user baik admin maupun bukan selama terotentikasi.</span></span>
<span id="cb4-156"><a href="#cb4-156" aria-hidden="true" tabindex="-1"></a>    mux<span class="op">.</span>HandleFunc<span class="op">(</span><span class="st">"/profile"</span><span class="op">,</span> <span class="kw">func</span><span class="op">(</span>w http<span class="op">.</span>ResponseWriter<span class="op">,</span> r <span class="op">*</span>http<span class="op">.</span>Request<span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-157"><a href="#cb4-157" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Ambil token dari cookie yang di kirim ketika request</span></span>
<span id="cb4-158"><a href="#cb4-158" aria-hidden="true" tabindex="-1"></a>        c<span class="op">,</span> err <span class="op">:=</span> r<span class="op">.</span>Cookie<span class="op">(</span><span class="st">"token"</span><span class="op">)</span></span>
<span id="cb4-159"><a href="#cb4-159" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> err <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb4-160"><a href="#cb4-160" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> err <span class="op">==</span> http<span class="op">.</span>ErrNoCookie <span class="op">{</span></span>
<span id="cb4-161"><a href="#cb4-161" aria-hidden="true" tabindex="-1"></a>                <span class="co">// return unauthorized ketika token kosong</span></span>
<span id="cb4-162"><a href="#cb4-162" aria-hidden="true" tabindex="-1"></a>                w<span class="op">.</span>WriteHeader<span class="op">(</span>http<span class="op">.</span>StatusUnauthorized<span class="op">)</span></span>
<span id="cb4-163"><a href="#cb4-163" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb4-164"><a href="#cb4-164" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb4-165"><a href="#cb4-165" aria-hidden="true" tabindex="-1"></a>            <span class="co">// return bad request ketika field token tidak ada</span></span>
<span id="cb4-166"><a href="#cb4-166" aria-hidden="true" tabindex="-1"></a>            w<span class="op">.</span>WriteHeader<span class="op">(</span>http<span class="op">.</span>StatusBadRequest<span class="op">)</span></span>
<span id="cb4-167"><a href="#cb4-167" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb4-168"><a href="#cb4-168" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb4-169"><a href="#cb4-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-170"><a href="#cb4-170" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Ambil value dari cookie token</span></span>
<span id="cb4-171"><a href="#cb4-171" aria-hidden="true" tabindex="-1"></a>        tknStr <span class="op">:=</span> c<span class="op">.</span>Value</span>
<span id="cb4-172"><a href="#cb4-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-173"><a href="#cb4-173" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Deklarasi variable claims yang akan kita isi dengan data hasil parsing JWT</span></span>
<span id="cb4-174"><a href="#cb4-174" aria-hidden="true" tabindex="-1"></a>        claims <span class="op">:=</span> <span class="op">&amp;</span>Claims<span class="op">{}</span></span>
<span id="cb4-175"><a href="#cb4-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-176"><a href="#cb4-176" aria-hidden="true" tabindex="-1"></a>        <span class="co">//parse JWT token ke dalam claims</span></span>
<span id="cb4-177"><a href="#cb4-177" aria-hidden="true" tabindex="-1"></a>        tkn<span class="op">,</span> err <span class="op">:=</span> jwt<span class="op">.</span>ParseWithClaims<span class="op">(</span>tknStr<span class="op">,</span> claims<span class="op">,</span> <span class="kw">func</span><span class="op">(</span>token <span class="op">*</span>jwt<span class="op">.</span>Token<span class="op">)</span> <span class="op">(</span><span class="kw">interface</span><span class="op">{},</span> <span class="dt">error</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-178"><a href="#cb4-178" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> jwtKey<span class="op">,</span> <span class="ot">nil</span></span>
<span id="cb4-179"><a href="#cb4-179" aria-hidden="true" tabindex="-1"></a>        <span class="op">})</span></span>
<span id="cb4-180"><a href="#cb4-180" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> err <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb4-181"><a href="#cb4-181" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> err <span class="op">==</span> jwt<span class="op">.</span>ErrSignatureInvalid <span class="op">{</span></span>
<span id="cb4-182"><a href="#cb4-182" aria-hidden="true" tabindex="-1"></a>                <span class="co">// return unauthorized ketika ada kesalahan ketika parsing token</span></span>
<span id="cb4-183"><a href="#cb4-183" aria-hidden="true" tabindex="-1"></a>                w<span class="op">.</span>WriteHeader<span class="op">(</span>http<span class="op">.</span>StatusUnauthorized<span class="op">)</span></span>
<span id="cb4-184"><a href="#cb4-184" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb4-185"><a href="#cb4-185" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb4-186"><a href="#cb4-186" aria-hidden="true" tabindex="-1"></a>            <span class="co">// return bad request ketika field token tidak ada</span></span>
<span id="cb4-187"><a href="#cb4-187" aria-hidden="true" tabindex="-1"></a>            w<span class="op">.</span>WriteHeader<span class="op">(</span>http<span class="op">.</span>StatusBadRequest<span class="op">)</span></span>
<span id="cb4-188"><a href="#cb4-188" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb4-189"><a href="#cb4-189" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb4-190"><a href="#cb4-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-191"><a href="#cb4-191" aria-hidden="true" tabindex="-1"></a>        <span class="co">//return unauthorized ketika token sudah tidak valid (biasanya karena token expired)</span></span>
<span id="cb4-192"><a href="#cb4-192" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">!</span>tkn<span class="op">.</span>Valid <span class="op">{</span></span>
<span id="cb4-193"><a href="#cb4-193" aria-hidden="true" tabindex="-1"></a>            w<span class="op">.</span>WriteHeader<span class="op">(</span>http<span class="op">.</span>StatusUnauthorized<span class="op">)</span></span>
<span id="cb4-194"><a href="#cb4-194" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb4-195"><a href="#cb4-195" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb4-196"><a href="#cb4-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-197"><a href="#cb4-197" aria-hidden="true" tabindex="-1"></a>        <span class="co">// return data dalam claims, yaitu username yang telah didefinisikan di variable claims</span></span>
<span id="cb4-198"><a href="#cb4-198" aria-hidden="true" tabindex="-1"></a>        w<span class="op">.</span>Write<span class="op">([]</span><span class="dt">byte</span><span class="op">(</span>fmt<span class="op">.</span>Sprintf<span class="op">(</span><span class="st">"Welcome %s!"</span><span class="op">,</span> claims<span class="op">.</span>Username<span class="op">)))</span></span>
<span id="cb4-199"><a href="#cb4-199" aria-hidden="true" tabindex="-1"></a>    <span class="op">})</span></span>
<span id="cb4-200"><a href="#cb4-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-201"><a href="#cb4-201" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> mux</span>
<span id="cb4-202"><a href="#cb4-202" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Untuk mencoba kode di atas menggunakan Postman, kita dapat mengikuti langkah-langkah berikut:</p>
<ul>
<li><p>Jalankan server dengan menjalankan perintah go run nama_file.go pada terminal.</p></li>
<li><p>Buka Postman dan buat request baru dengan metode POST. Isikan alamat URL dengan http://localhost:8080/login</p></li>
<li><p>Pada tab body, pilih raw dan pilih JSON(application/json) sebagai format yang digunakan.</p></li>
<li><p>Isikan body dengan format JSON berikut {“username”:“aditira”, “password”:“password1”}</p></li>
<li><p>Klik tombol send untuk mengirimkan request.</p></li>
<li><p>Jika login berhasil, server akan mengeluarkan token JWT yang diterima dalam bentuk cookie. Anda dapat menggunakan token ini untuk mengirimkan permintaan ke halaman yang dibatasi oleh otorisasi.</p></li>
<li><p>Buat request baru dengan metode GET, isikan alamat URL dengan http://localhost:8080/admin</p></li>
<li><p>Klik tombol send untuk mengirimkan request.</p></li>
<li><p>Jika token yang digunakan valid, server akan mengirimkan respon yang sesuai. Jika tidak, server akan mengembalikan kode respon 401 Unauthorized.</p></li>
</ul>
</section>
</section>
<section id="oauth" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="oauth"><span class="header-section-number">5.2</span> OAuth</h2>
<section id="pengertian-1" class="level3" data-number="5.2.1">
<h3 data-number="5.2.1" class="anchored" data-anchor-id="pengertian-1"><span class="header-section-number">5.2.1</span> Pengertian</h3>
<p>OAuth (Open Authorization) adalah protokol otentikasi yang memungkinkan aplikasi untuk mengakses layanan atau data milik user tanpa memberikan informasi login (seperti username dan password) ke aplikasi tersebut.</p>
<p>OAuth digunakan oleh banyak layanan web populer, seperti Google, Facebook, Twitter, dan lainnya, untuk mengizinkan aplikasi lain untuk mengakses data user yang tersimpan di layanan tersebut.</p>
</section>
<section id="why-oauth" class="level3" data-number="5.2.2">
<h3 data-number="5.2.2" class="anchored" data-anchor-id="why-oauth"><span class="header-section-number">5.2.2</span> Why OAuth?</h3>
<p>OAuth memungkinkan user untuk mengontrol hak akses yang diberikan ke aplikasi dan mudah untuk membatalkannya jika diperlukan. Selain itu, OAuth juga memungkinkan aplikasi untuk mengakses data dari berbagai layanan tanpa harus mengimplementasikan otentikasi yang berbeda untuk setiap layanan.</p>
<p>Misalnya jika seorang user ingin menghubungkan aplikasi foto miliknya dengan akun Instagram-nya, dia dapat menggunakan OAuth untuk memberikan aplikasi foto akses ke akun Instagram-nya tanpa harus memberikan kredensial akun Instagram-nya ke aplikasi foto tersebut. User juga dapat mengontrol hak akses yang diberikan ke aplikasi dan membatalkannya jika diperlukan.</p>
<p>Contoh lain adalah ketika user ingin mengirim email dari aplikasi email tertentu menggunakan akun Google-nya, user dapat menggunakan OAuth untuk memberikan akses ke aplikasi tersebut tanpa harus memberikan password Google-nya.</p>
</section>
<section id="basic-flow" class="level3" data-number="5.2.3">
<h3 data-number="5.2.3" class="anchored" data-anchor-id="basic-flow"><span class="header-section-number">5.2.3</span> Basic Flow</h3>
<p>Basic flow dari OAuth adalah sebagai berikut:</p>
<ul>
<li><p>Aplikasi client mengirim permintaan otentikasi ke server OAuth.</p></li>
<li><p>User diminta untuk masuk dengan akun yang sesuai.</p></li>
<li><p>Setelah masuk, server OAuth mengarahkan user ke halaman izin yang menjelaskan hak akses yang diminta oleh aplikasi client.</p></li>
<li><p>User menyetujui atau menolak izin yang diminta.</p></li>
<li><p>Jika izin diterima, server OAuth mengirim token akses ke aplikasi client.</p></li>
<li><p>Aplikasi client menggunakan token akses untuk mengakses data dari server layanan.</p></li>
<li><p>Server layanan mengecek token akses dan memberikan akses ke data user jika token valid.</p></li>
</ul>
<p>Itu adalah alur dasar dari OAuth, dan mungkin ada variasi dari implementasi ke implementasi. Namun prinsip dasarnya sama, yaitu mengizinkan aplikasi untuk mengakses data pribadi user dengan aman tanpa memberikan kredensial user tersebut ke aplikasi.</p>
<p><img src="image-2.png" class="img-fluid"></p>
</section>
<section id="implementasi-oauth" class="level3" data-number="5.2.4">
<h3 data-number="5.2.4" class="anchored" data-anchor-id="implementasi-oauth"><span class="header-section-number">5.2.4</span> Implementasi OAuth</h3>
<div class="sourceCode" id="cb5"><pre class="sourceCode go code-with-copy"><code class="sourceCode go"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">package</span> main</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="op">(</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"fmt"</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"net/http"</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"golang.org/x/oauth2"</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"golang.org/x/oauth2/google"</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> <span class="op">(</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    googleOauthConfig <span class="op">=</span> <span class="op">&amp;</span>oauth2<span class="op">.</span>Config<span class="op">{</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>        RedirectURL<span class="op">:</span>  <span class="st">"http://localhost:8080/callback"</span><span class="op">,</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>        ClientID<span class="op">:</span>     <span class="st">"YOUR_CLIENT_ID"</span><span class="op">,</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>        ClientSecret<span class="op">:</span> <span class="st">"YOUR_CLIENT_SECRET"</span><span class="op">,</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>        Scopes<span class="op">:</span>       <span class="op">[]</span><span class="dt">string</span><span class="op">{</span><span class="st">"https://www.googleapis.com/auth/userinfo.profile"</span><span class="op">,</span> <span class="st">"https://www.googleapis.com/auth/userinfo.email"</span><span class="op">},</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>        Endpoint<span class="op">:</span>     google<span class="op">.</span>Endpoint<span class="op">,</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Some random string, random for each request</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    oauthStateString <span class="op">=</span> <span class="st">"random"</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    http<span class="op">.</span>HandleFunc<span class="op">(</span><span class="st">"/"</span><span class="op">,</span> handleMain<span class="op">)</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>    http<span class="op">.</span>HandleFunc<span class="op">(</span><span class="st">"/login"</span><span class="op">,</span> handleGoogleLogin<span class="op">)</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>    http<span class="op">.</span>HandleFunc<span class="op">(</span><span class="st">"/callback"</span><span class="op">,</span> handleGoogleCallback<span class="op">)</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>    fmt<span class="op">.</span>Println<span class="op">(</span>http<span class="op">.</span>ListenAndServe<span class="op">(</span><span class="st">":8080"</span><span class="op">,</span> <span class="ot">nil</span><span class="op">))</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> handleMain<span class="op">(</span>w http<span class="op">.</span>ResponseWriter<span class="op">,</span> r <span class="op">*</span>http<span class="op">.</span>Request<span class="op">)</span> <span class="op">{</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> htmlIndex <span class="op">=</span> <span class="st">`&lt;html&gt;&lt;body&gt;</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;a href="/login"&gt;Google Log In&lt;/a&gt;</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;/body&gt;&lt;/html&gt;`</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>    fmt<span class="op">.</span>Fprintf<span class="op">(</span>w<span class="op">,</span> htmlIndex<span class="op">)</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> handleGoogleLogin<span class="op">(</span>w http<span class="op">.</span>ResponseWriter<span class="op">,</span> r <span class="op">*</span>http<span class="op">.</span>Request<span class="op">)</span> <span class="op">{</span></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>    url <span class="op">:=</span> googleOauthConfig<span class="op">.</span>AuthCodeURL<span class="op">(</span>oauthStateString<span class="op">)</span></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>    http<span class="op">.</span>Redirect<span class="op">(</span>w<span class="op">,</span> r<span class="op">,</span> url<span class="op">,</span> http<span class="op">.</span>StatusTemporaryRedirect<span class="op">)</span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> handleGoogleCallback<span class="op">(</span>w http<span class="op">.</span>ResponseWriter<span class="op">,</span> r <span class="op">*</span>http<span class="op">.</span>Request<span class="op">)</span> <span class="op">{</span></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>    state <span class="op">:=</span> r<span class="op">.</span>FormValue<span class="op">(</span><span class="st">"state"</span><span class="op">)</span></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> state <span class="op">!=</span> oauthStateString <span class="op">{</span></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>        fmt<span class="op">.</span>Printf<span class="op">(</span><span class="st">"invalid oauth state, expected '%s', got '%s'</span><span class="ch">\n</span><span class="st">"</span><span class="op">,</span> oauthStateString<span class="op">,</span> state<span class="op">)</span></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>        http<span class="op">.</span>Redirect<span class="op">(</span>w<span class="op">,</span> r<span class="op">,</span> <span class="st">"/"</span><span class="op">,</span> http<span class="op">.</span>StatusTemporaryRedirect<span class="op">)</span></span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>    code <span class="op">:=</span> r<span class="op">.</span>FormValue<span class="op">(</span><span class="st">"code"</span><span class="op">)</span></span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>    token<span class="op">,</span> err <span class="op">:=</span> googleOauthConfig<span class="op">.</span>Exchange<span class="op">(</span>oauth2<span class="op">.</span>NoContext<span class="op">,</span> code<span class="op">)</span></span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> err <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>        fmt<span class="op">.</span>Println<span class="op">(</span><span class="st">"Code exchange failed with '%s'</span><span class="ch">\n</span><span class="st">"</span><span class="op">,</span> err<span class="op">)</span></span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>        http<span class="op">.</span>Redirect<span class="op">(</span>w<span class="op">,</span> r<span class="op">,</span> <span class="st">"/"</span><span class="op">,</span> http<span class="op">.</span>StatusTemporaryRedirect<span class="op">)</span></span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>    response<span class="op">,</span> err <span class="op">:=</span> http<span class="op">.</span>Get<span class="op">(</span><span class="st">"https://www.googleapis.com/oauth2/v2/userinfo?access_token="</span> <span class="op">+</span> token<span class="op">.</span>AccessToken<span class="op">)</span></span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">defer</span> response<span class="op">.</span>Body<span class="op">.</span>Close<span class="op">()</span></span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>    contents<span class="op">,</span> err <span class="op">:=</span> ioutil<span class="op">.</span>ReadAll<span class="op">(</span>response<span class="op">.</span>Body<span class="op">)</span></span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>    fmt<span class="op">.</span>Fprintf<span class="op">(</span>w<span class="op">,</span> <span class="st">"Content: %s</span><span class="ch">\n</span><span class="st">"</span><span class="op">,</span> contents<span class="op">)</span></span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>